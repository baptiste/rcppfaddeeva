<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast calculation of the Voigt lineshape via the Faddeeva function • RcppFaddeeva</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">RcppFaddeeva</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/plasmonics/rcppfaddeeva">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Fast calculation of the Voigt lineshape via the Faddeeva function</h1>
                        <h4 class="author">baptiste Auguié</h4>
            
            <h4 class="date">22 February, 2017</h4>
          </div>

    
    
<div class="contents">
<p>The Voigt lineshape is important in many fields of spectroscopy, yet the direct approach of numerical convolution between a Lorentzian and a Gaussian can be too slow. With the <code>RcppFaddeeva</code> package we leverage in <code>R</code> the elegant <code>c++</code> routines provided by Steve G. Johnson for the calculation of the closely related Faddeeva function, with seamless bindings provided by <code>Rcpp</code>.</p>
<div id="voigt-profile-obtained-from-faddeeva_w" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#voigt-profile-obtained-from-faddeeva_w" class="anchor"> </a></body></html>Voigt profile, obtained from <code>Faddeeva_w</code>
</h2>
<p>In this example we compare the Gaussian, Lorentzian, and Voigt lineshapes for a peak centred at 200.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">palette</span>(<span class="kw">c</span>(<span class="kw">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E41A1C"</span>, <span class="st">"#377EB8"</span>, <span class="st">"#4DAF4A"</span>, <span class="st">"#984EA3"</span>, <span class="st">"#FF7F00"</span>), <span class="kw">palette</span>()))
<span class="kw">library</span>(RcppFaddeeva)
x &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">300</span>, <span class="dv">800</span>)
x0 &lt;-<span class="st"> </span><span class="dv">200</span>
l &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Voigt.html">Lorentz</a></span>(x, x0, <span class="dv">30</span>)
g &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Voigt.html">Gauss</a></span>(x, x0, <span class="dv">100</span>)

## brute-force convolution
<span class="co"># (discrete convolve() would perform better but indexing is tricky)</span>
lg &lt;-<span class="st"> </span>function(x) {
  <span class="kw">integrate</span>(function(t) <span class="kw"><a href="../reference/Voigt.html">Lorentz</a></span>(t, <span class="dv">0</span>, <span class="dv">30</span>) *<span class="st">  </span><span class="kw"><a href="../reference/Voigt.html">Gauss</a></span>(x-t, x0, <span class="dv">100</span>),
            -<span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dt">rel.tol =</span> <span class="fl">1e-6</span>)$value
}
c &lt;-<span class="st"> </span><span class="kw">sapply</span>(x, lg)

v &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Voigt.html">Voigt</a></span>(x, x0, <span class="dv">100</span>, <span class="dv">30</span>)
<span class="kw">matplot</span>(x, <span class="kw">cbind</span>(v, l, g, c), <span class="dt">t=</span><span class="st">"l"</span>, <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">xlab=</span><span class="st">"x"</span>, <span class="dt">ylab=</span><span class="st">""</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">legend</span>(<span class="st">"topleft"</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">"Voigt"</span>, <span class="st">"Lorentz"</span>, <span class="st">"Gauss"</span>, <span class="st">"Convolution"</span>), <span class="dt">bty=</span><span class="st">"n"</span>,
      <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">col=</span><span class="dv">1</span>:<span class="dv">4</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="voigt_files/figure-html/plot-1.png" width="672"></p>
<p>We also check that the prefactors are correct; the three distributions should integrate to unity (note that if <code>x0</code> is too far from the origin and/or the distribution is too narrow, <code>integrate()</code> may fail to sample the center of mass and give an erroneous answer).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">integrate</span>(Lorentz, -<span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dt">x0=</span><span class="dv">200</span>, <span class="dt">gamma=</span><span class="dv">100</span>)</code></pre></div>
<pre><code>## 1 with absolute error &lt; 1.2e-06</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">integrate</span>(Gauss, -<span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dt">x0=</span><span class="dv">200</span>, <span class="dt">sigma=</span><span class="dv">50</span>)</code></pre></div>
<pre><code>## 1 with absolute error &lt; 6.4e-06</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">integrate</span>(Voigt, -<span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="dt">x0=</span><span class="dv">200</span>, <span class="dt">sigma=</span><span class="dv">50</span>, <span class="dt">gamma=</span><span class="dv">100</span>)</code></pre></div>
<pre><code>## 1 with absolute error &lt; 7.6e-09</code></pre>
<p>An interesting side-effect of obtaining the Voigt lineshape via the imaginary part of the complex Faddeeva function is the direct access to its harmonic conjugate in the real part. This can be useful in modelling optical response functions connected by a Hilbert transform.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">1000</span>, <span class="dv">1000</span>)
x0 &lt;-<span class="st"> </span><span class="dv">200</span>
v &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Voigt.html">Voigt</a></span>(x, x0, <span class="dv">100</span>, <span class="dv">30</span>, <span class="dt">real =</span> <span class="ot">FALSE</span>)
<span class="kw">matplot</span>(x, <span class="kw">cbind</span>(<span class="kw">Re</span>(v), <span class="kw">Im</span>(v)), <span class="dt">t=</span><span class="st">"l"</span>, <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">xlab=</span><span class="st">""</span>, <span class="dt">ylab=</span><span class="st">""</span>, <span class="dt">col=</span><span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">legend</span>(<span class="st">"topleft"</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">"Imaginary part"</span>, <span class="st">"Real part"</span>), <span class="dt">bty=</span><span class="st">"n"</span>,
      <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">col=</span><span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="voigt_files/figure-html/complex-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#voigt-profile-obtained-from-faddeeva_w">Voigt profile, obtained from <code>Faddeeva_w</code></a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Baptiste Auguie, Dirk Eddelbuettel, Steven G. Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
